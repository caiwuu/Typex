<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Cai Wu"><meta name="description" content="A Editor Core"><title>Source: core/model/path.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="light" data-theme="light"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a style="font:bold 30px/30px 黑体;color:#999;text-align:center;text-decoration:none" href="./index.html">Typex-Document</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="MDvL0UJvWoC77UgDrTPiv"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="Caret.html">Caret</a></div><div class="sidebar-section-children"><a href="Component.html">Component</a></div><div class="sidebar-section-children"><a href="Content.html">Content</a></div><div class="sidebar-section-children"><a href="Formater.html">Formater</a></div><div class="sidebar-section-children"><a href="Measure.html">Measure</a></div><div class="sidebar-section-children"><a href="Path.html">Path</a></div><div class="sidebar-section-children"><a href="Range.html">Range</a></div><div class="sidebar-section-children"><a href="Selection.html">Selection</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="co8joSSBv-gOxKeniWCiK"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#Element">Element</a></div><div class="sidebar-section-children"><a href="global.html#addVnodes">addVnodes</a></div><div class="sidebar-section-children"><a href="global.html#computeOffset">computeOffset</a></div><div class="sidebar-section-children"><a href="global.html#computeScroll">computeScroll</a></div><div class="sidebar-section-children"><a href="global.html#createKeyToOldIdx">createKeyToOldIdx</a></div><div class="sidebar-section-children"><a href="global.html#createPath">createPath</a></div><div class="sidebar-section-children"><a href="global.html#defer">defer</a></div><div class="sidebar-section-children"><a href="global.html#del">del</a></div><div class="sidebar-section-children"><a href="global.html#findIdxInOld">findIdxInOld</a></div><div class="sidebar-section-children"><a href="global.html#flush">flush</a></div><div class="sidebar-section-children"><a href="global.html#getRect">getRect</a></div><div class="sidebar-section-children"><a href="global.html#horizontalMove">horizontalMove</a></div><div class="sidebar-section-children"><a href="global.html#initDispatcher">initDispatcher</a></div><div class="sidebar-section-children"><a href="global.html#input">input</a></div><div class="sidebar-section-children"><a href="global.html#inputText">inputText</a></div><div class="sidebar-section-children"><a href="global.html#invokeDestroyHook">invokeDestroyHook</a></div><div class="sidebar-section-children"><a href="global.html#isSameLine">isSameLine</a></div><div class="sidebar-section-children"><a href="global.html#loop">loop</a></div><div class="sidebar-section-children"><a href="global.html#onContentDelete">onContentDelete</a></div><div class="sidebar-section-children"><a href="global.html#patchVnode">patchVnode</a></div><div class="sidebar-section-children"><a href="global.html#positionCompare">positionCompare</a></div><div class="sidebar-section-children"><a href="global.html#queryCommonPath">queryCommonPath</a></div><div class="sidebar-section-children"><a href="global.html#queryPath">queryPath</a></div><div class="sidebar-section-children"><a href="global.html#queryPathByElm">queryPathByElm</a></div><div class="sidebar-section-children"><a href="global.html#queryPathByPosition">queryPathByPosition</a></div><div class="sidebar-section-children"><a href="global.html#queryPathByVn">queryPathByVn</a></div><div class="sidebar-section-children"><a href="global.html#queryRootPath">queryRootPath</a></div><div class="sidebar-section-children"><a href="global.html#removeVnodes">removeVnodes</a></div><div class="sidebar-section-children"><a href="global.html#renderRoot">renderRoot</a></div><div class="sidebar-section-children"><a href="global.html#sameVnode">sameVnode</a></div><div class="sidebar-section-children"><a href="global.html#setStyle">setStyle</a></div><div class="sidebar-section-children"><a href="global.html#transformOps">transformOps</a></div><div class="sidebar-section-children"><a href="global.html#updateChildren">updateChildren</a></div><div class="sidebar-section-children"><a href="global.html#verticalMove">verticalMove</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="home-class navbar-item"><a id="home-id" href="./index.html" target="">Home</a></div><div class="github-class navbar-item"><a id="github-id" href="https://github.com/caiwuu/Typex" target="_blank">Github</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">core_model_path.js</h1></header><article><pre class="prettyprint source lang-js"><code>import { getVdomOrElm, getVdomOrPath } from '../mappings'
import { computeLen, typeOf, positionCompare, isPrimitive } from '../utils'

/**
 * @description 路径类
 * @export
 * @class Path
 */
export class Path {
  /**
   * @description 标记删除
   * @protected
   * @memberof Path
   */
  _shouldDelete = false

  /**
   * @description 标记重建
   * @protected
   * @memberof Path
   */
  _shouldRebuild = false
  constructor({ node, parent, position, prevSibling, nextSibling, children }) {
    this.node = node
    this.parent = parent
    this.position = position
    this.prevSibling = prevSibling
    this.nextSibling = nextSibling
    this.children = children
  }

  /**
   * @description path所属组件的实例
   * @readonly
   * @memberof Path
   */
  get component() {
    return this._$component || this.parent.component
  }

  /**
   * @description path内容长度
   * @readonly
   * @memberof Path
   */
  get len() {
    return computeLen(this)
  }

  /**
   * @description path对应的真实dom
   * @readonly
   * @memberof Path
   */
  get elm() {
    return getVdomOrElm(this.vn)
  }

  /**
   * @description 路径类型
   * @readonly
   * @memberof Path
   */
  get pathType() {
    switch (this.dataType) {
      case 'String':
        return 3
      case 'Object':
        return 2
      case 'Array':
        return 1
    }
  }
  /**
   * @description 数据类型
   * @readonly
   * @memberof Path
   */
  get dataType() {
    return typeOf(this.node.data)
  }

  /**
   * @description path所属的块级组件实例
   * @readonly
   * @memberof Path
   */
  get blockComponent() {
    if (this.component._type === 'block') return this.component
    return this.parent.blockComponent
  }

  /**
   * @description path对应的虚拟dom
   * @readonly
   * @memberof Path
   */
  get vn() {
    return getVdomOrPath(this)
  }

  /**
   * @description 是否是叶子节点
   * @readonly
   * @memberof Path
   */
  get isLeaf() {
    return this.children.length === 0
  }

  /**
   * @description 第一个叶子节点
   * @readonly
   * @memberof Path
   */
  get firstLeaf() {
    let path = this
    while (path.children &amp;&amp; path.children.length) {
      path = path.children[0]
    }
    return path
  }

  /**
   * @description 最后一个叶子节点
   * @readonly
   * @memberof Path
   */
  get lastLeaf() {
    let path = this
    while (path.children &amp;&amp; path.children.length) {
      path = path.children[path.children.length - 1]
    }
    return path
  }

  /**
   * @description 同级索引
   * @readonly
   * @memberof Path
   */
  get index() {
    return this.position.split('-').slice(-1)[0] / 1
  }

  /**
   * @description 上一个叶子节点
   * @readonly
   * @memberof Path
   */
  get prevLeaf() {
    return (this.prevSibling || this.parent?.prevLeaf)?.lastLeaf
  }

  /**
   * @description 下一个叶子节点
   * @readonly
   * @memberof Path
   */
  get nextLeaf() {
    return (this.nextSibling || this.parent?.nextLeaf)?.firstLeaf
  }

  /**
   * @description 文本插入
   * @param {String} pos 从根节点组成的索引链 如'0-0-1-1-2'
   * @param {String} data 插入字符
   * @memberof Path
   */
  insertData(pos, data) {
    this.node.data = this.node.data.slice(0, pos) + data + this.node.data.slice(pos)
  }

  /**
   * @description 内容删除
   * @param {Number} offset 偏移量,开始删除的位置
   * @param {Number} count  删除的字符数量
   * @memberof Path
   */
  textDelete(offset, count) {
    this.node.data = this.node.data.slice(0, offset - count) + this.node.data.slice(offset)
  }

  /**
   * @description 清除格式
   * @memberof Path
   */
  clearFormat() {
    this.node.formats = {}
  }

  /**
   * @description 设置节点
   * @param {*} [{ data = '', formats = {} }={}]
   * @memberof Path
   */
  setNode({ data = '', formats = {} } = {}) {
    this.node.data = data
    this.node.formats = formats
  }
  /**
   * @description 设置格式(只会merge格式，不会强制覆盖其他格式)
   * @param {Object} formats 格式
   * @memberof Path
   */
  setFormat(formats) {
    Object.assign(this.node.formats, formats)
  }
  /**
   * @description path分割
   * @param {Number} index 分隔位置
   * @returns {Path[]} path列表
   * @memberof Path
   */
  split(index) {
    if (this.pathType === 3) {
      const newPath = createPath({
        data: this.node.data.slice(index),
        formats: { ...this.node.formats },
      })
      this.textDelete(this.len, this.len - index)
      newPath.insertAfter(this)
      return [this, newPath]
    } else {
      const newPath = createPath({
        data: [],
        formats: { ...this.node.formats },
      })
      this.children.slice(index).forEach((path) => {
        path.moveTo(newPath)
      })
      newPath.insertAfter(this)
      return [this, newPath]
    }
  }

  /**
   * @description 标记克隆
   * @returns {Path}
   * @memberof Path
   */
  cloneMark() {
    return createPath({
      data: isPrimitive(this.node.data) ? '' : this.node.data ? [] : {},
      formats: { ...this.node.formats },
    })
  }
  /**
   * @description path删除
   * @param {boolean} [delEmptyParent=false]
   * @memberof Path
   */
  delete(delEmptyParent = false) {
    if (!this.parent) {
      return
    }
    this._shouldDelete = true
    this.parent.rebuild()
    if (delEmptyParent &amp;&amp; !this.parent.len) {
      this.parent.delete(true)
    }
  }

  /**
   * @description - 位置比较
   * @example
   * res = a.positionCompare(b),
   * res=-1: a&lt;b;
   * res=0: a===b;
   * res=1: a>b
   * @param {Path} path
   * @returns {Number}
   * @memberof Path
   */
  positionCompare(path) {
    return positionCompare(this, path)
  }

  /**
   * @description 是否源于 xxx
   * @param {Path} path
   * @returns {Boolean}
   * @memberof Path
   */
  originOf(path) {
    return this.position.includes(path.position + '-')
  }

  /**
   * @description 插入到path前面
   * @param {Path} path
   * @memberof Path
   */
  insertBefore(path) {
    path.parent.children.splice(path.index, 0, this)
    this.delete(true)
    path.parent.rebuild()
  }

  /**
   * @description 插入到path后面
   * @param {Path} path
   * @memberof Path
   */
  insertAfter(path) {
    path.parent.children.splice(path.index + 1, 0, this)
    this.delete(true)
    path.parent.rebuild()
  }
  /**
   * @description 移动到path的children
   * @param {Path} path
   * @memberof Path
   */
  moveTo(path) {
    path.children.push(this)
    this.delete(true)
    path.rebuild()
  }

  /**
   * @description 插入到path前面
   * @param {Path} path
   * @memberof Path
   */
  insertChildrenBefore(path) {
    path.parent.children.splice(path.index, 0, ...this.children)
    this.delete(true)
    path.parent.rebuild()
  }

  /**
   * @description 插入到path后面
   * @param {Path} path
   * @memberof Path
   */
  insertChildrenAfter(path) {
    path.parent.children.splice(path.index + 1, 0, ...this.children)
    this.delete(true)
    if (path.len === 0) path.delete(true)
    path.parent.rebuild()
  }
  /**
   * @description 删除两个节点之间的所有节点 不包含开始结束节点
   * @param {Path} startPath 开始节点
   * @param {Path} endPath 结束节点
   * @memberof Path
   */
  deleteBetween(startPath, endPath) {
    const pathsToRebuild = []
    if (this === startPath || this === endPath || startPath === endPath) return
    const traverse = (path) => {
      for (var i = 0; i &lt; path.children.length; i++) {
        const ele = path.children[i]
        if (startPath.originOf(ele) || endPath.originOf(ele)) {
          traverse(ele)
        } else if (ele.positionCompare(startPath) === 1 &amp;&amp; ele.positionCompare(endPath) === -1) {
          ele._shouldDelete = true
          if (!ele.parent?._shouldRebuild) {
            pathsToRebuild.push(ele.parent)
            ele.parent._shouldRebuild = true
          }
        }
      }
    }
    traverse(this)
    pathsToRebuild.forEach((path) => path.rebuild())
  }
  /**
   * @description 重构链表树
   * @memberof Path
   */
  rebuild() {
    if (this.dataType !== 'Array') return
    this._shouldRebuild = false
    let cachePath = null
    this.children = this.children.filter((ele) => {
      if (ele._shouldDelete) {
        ele._shouldDelete = false
      } else {
        return true
      }
    })
    // 为了保持marks索引，使用length = 0来清空数组
    this.node.data.length = 0
    this.children.forEach((path, index) => {
      // 更新父级
      path.parent = this
      // 同步mark子节点
      this.node.data.push(path.node)
      // 重新维护链表结构
      path.prevSibling = cachePath
      if (cachePath) {
        cachePath.nextSibling = path
      }
      path.nextSibling = null
      cachePath = path
      // 更新位置坐标
      const newPosition = this.position + '-' + index
      if (path.position !== newPosition) {
        path.position = path.node.position = newPosition
        path.rebuild()
      }
    })
  }
}

/**
 * @description 创建path
 * @export
 * @param {Object} node 标记
 * @param node.data {String|Object}
 * @param node.formats {Object}
 * @param {Path} [parent=null]
 * @param {Path} [prevSibling=null]
 * @param {Path} [nextSibling=null]
 * @param {Number} [index=0]
 * @returns {Path}
 */
export function createPath(node, parent = null, prevSibling = null, nextSibling = null, index = 0) {
  const position = parent ? parent.position + '-' + index : '0'
  node.position = position
  if (!node.formats) node.formats = {}
  const config = {
    node: node,
    parent: parent,
    position: position,
    prevSibling: prevSibling,
    nextSibling: nextSibling,
    children: [],
  }
  const path = new Path(config)
  if (node.data) {
    let currPath = null
    node.data.reduce?.((prevPath, currMark, index) => {
      currPath = createPath(currMark, path, prevPath, null, index)
      if (prevPath) {
        prevPath.nextSibling = currPath
      }
      currPath.prevSibling = prevPath
      path.children.push(currPath)
      return currPath
    }, null)
  }
  return path
}

/**
 * @description 查询根路径
 * @param {*} path
 * @returns {*}
 */
function queryRootPath(path) {
  while (path.parent) {
    path = path.parent
  }
  return path
}
/**
 * @desc: 查找共同祖先path
 * @param {elm|vn|position} target
 * @param {path} path
 * @return {path}
 */
export function queryCommonPath(path1, path2) {
  if (path1 === path2) return path1
  if (path1.position === '0') return path1
  if (path2.position === '0') return path2
  const rootPath = queryRootPath(path1)
  const posArr1 = path1.position.split('-')
  const posArr2 = path2.position.split('-')
  const minLen = Math.min(posArr1.length, posArr2.length)
  let i
  for (i = 0; i &lt; minLen; i++) {
    const element1 = posArr1[i]
    const element2 = posArr2[i]
    if (element1 !== element2) break
  }
  const commonPosition = posArr1.slice(0, i).join('-')
  return queryPathByPosition(commonPosition, rootPath)
}
/**
 * @desc: path查找
 * @param {elm|vn|position} target
 * @param {path} path
 * @return {path}
 */
export function queryPath(target, path) {
  if (target instanceof Path) return target
  if (target.nodeType) return queryPathByElm(target)
  if (target.vnodeType) return queryPathByVn(target)
  if (typeof target === 'string') return queryPathByPosition(target, path)
  throw 'queryPath的参数必须是elm|vn|position'
}

/**
 * @description 根据dom查询path
 * @param {*} elm
 * @returns {*}
 */
function queryPathByElm(elm) {
  const vn = getVdomOrElm(elm)
  if (!vn) return null
  return queryPathByVn(vn)
}

/**
 * @description 根据虚拟dom查询path
 * @param {*} vn
 * @returns {*}
 */
function queryPathByVn(vn) {
  const path = getVdomOrPath(vn)
  if (!path) return null
  return path
}

/**
 * @description 根据坐标查询path
 * @param {*} position
 * @param {*} rootPath
 * @returns {*}
 */
function queryPathByPosition(position, rootPath) {
  const posArr = position.split('-')
  return posArr.slice(1).reduce((prev, index) => {
    return prev.children[index]
  }, rootPath)
}
</code></pre></article></section><footer class="footer" id="PeOAagUepe"><div class="wrapper"><div style="font-size:16px;color:#ff6c6c;text-align:center">Typex 欢迎各位对编辑器感兴趣的同学加入 QQ群:616405713</div></div></footer></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a style="font:bold 30px/30px 黑体;color:#999;text-align:center;text-decoration:none" href="./index.html">Typex-Document</a><div class="mobile-nav-links"><div class="home-class navbar-item"><a id="home-id-mobile" href="./index.html" target="">Home</a></div><div class="github-class navbar-item"><a id="github-id-mobile" href="https://github.com/caiwuu/Typex" target="_blank">Github</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="MDvL0UJvWoC77UgDrTPiv"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="Caret.html">Caret</a></div><div class="sidebar-section-children"><a href="Component.html">Component</a></div><div class="sidebar-section-children"><a href="Content.html">Content</a></div><div class="sidebar-section-children"><a href="Formater.html">Formater</a></div><div class="sidebar-section-children"><a href="Measure.html">Measure</a></div><div class="sidebar-section-children"><a href="Path.html">Path</a></div><div class="sidebar-section-children"><a href="Range.html">Range</a></div><div class="sidebar-section-children"><a href="Selection.html">Selection</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="co8joSSBv-gOxKeniWCiK"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#Element">Element</a></div><div class="sidebar-section-children"><a href="global.html#addVnodes">addVnodes</a></div><div class="sidebar-section-children"><a href="global.html#computeOffset">computeOffset</a></div><div class="sidebar-section-children"><a href="global.html#computeScroll">computeScroll</a></div><div class="sidebar-section-children"><a href="global.html#createKeyToOldIdx">createKeyToOldIdx</a></div><div class="sidebar-section-children"><a href="global.html#createPath">createPath</a></div><div class="sidebar-section-children"><a href="global.html#defer">defer</a></div><div class="sidebar-section-children"><a href="global.html#del">del</a></div><div class="sidebar-section-children"><a href="global.html#findIdxInOld">findIdxInOld</a></div><div class="sidebar-section-children"><a href="global.html#flush">flush</a></div><div class="sidebar-section-children"><a href="global.html#getRect">getRect</a></div><div class="sidebar-section-children"><a href="global.html#horizontalMove">horizontalMove</a></div><div class="sidebar-section-children"><a href="global.html#initDispatcher">initDispatcher</a></div><div class="sidebar-section-children"><a href="global.html#input">input</a></div><div class="sidebar-section-children"><a href="global.html#inputText">inputText</a></div><div class="sidebar-section-children"><a href="global.html#invokeDestroyHook">invokeDestroyHook</a></div><div class="sidebar-section-children"><a href="global.html#isSameLine">isSameLine</a></div><div class="sidebar-section-children"><a href="global.html#loop">loop</a></div><div class="sidebar-section-children"><a href="global.html#onContentDelete">onContentDelete</a></div><div class="sidebar-section-children"><a href="global.html#patchVnode">patchVnode</a></div><div class="sidebar-section-children"><a href="global.html#positionCompare">positionCompare</a></div><div class="sidebar-section-children"><a href="global.html#queryCommonPath">queryCommonPath</a></div><div class="sidebar-section-children"><a href="global.html#queryPath">queryPath</a></div><div class="sidebar-section-children"><a href="global.html#queryPathByElm">queryPathByElm</a></div><div class="sidebar-section-children"><a href="global.html#queryPathByPosition">queryPathByPosition</a></div><div class="sidebar-section-children"><a href="global.html#queryPathByVn">queryPathByVn</a></div><div class="sidebar-section-children"><a href="global.html#queryRootPath">queryRootPath</a></div><div class="sidebar-section-children"><a href="global.html#removeVnodes">removeVnodes</a></div><div class="sidebar-section-children"><a href="global.html#renderRoot">renderRoot</a></div><div class="sidebar-section-children"><a href="global.html#sameVnode">sameVnode</a></div><div class="sidebar-section-children"><a href="global.html#setStyle">setStyle</a></div><div class="sidebar-section-children"><a href="global.html#transformOps">transformOps</a></div><div class="sidebar-section-children"><a href="global.html#updateChildren">updateChildren</a></div><div class="sidebar-section-children"><a href="global.html#verticalMove">verticalMove</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">function foo(){console.log("foo")}</script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>