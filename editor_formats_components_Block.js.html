<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: editor/formats/components/Block.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: editor/formats/components/Block.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * @Description:
 * @Author: caiwu
 * @CreateDate:
 * @LastEditor:
 * @LastEditTime: 2022-11-22 16:20:35
 */
import { Content } from '@/core'
const mergeBlock = (o, n, shouldUpdates = []) => {
  const oBlock = o.blockComponent
  if (o.blockComponent !== n.blockComponent) {
    if (n.len === 0) {
      n.component.$editor.selection.rangePoints
        .filter((point) => point.container === n)
        .forEach((point) => {
          if (point.pointName === 'start') {
            console.log(n.nextLeaf)
            point.range.setStart(n.nextLeaf, 0)
          } else {
            point.range.setEnd(n.nextLeaf, 0)
          }
        })
    }
    o.blockComponent.$path.insertChildrenAfter(n)
    oBlock.$path.parent.component.update()
    shouldUpdates.forEach((ins) => {
      ins.component.update()
    })
  }
}
export default class Block extends Content {
  _type = 'block'
  /**
   * @desc: 删除动作
   * @param {*} commonPath
   * @param {*} range
   * @return {*}
   */
  contentDelete (commonPath, range) {
    const { endContainer, endOffset, startContainer, startOffset, collapsed } = range
    // 选区折叠
    if (collapsed) {
      if (endOffset > 0) {
        // 执行删除
        startContainer.contentDelete(endOffset, 1)
        if (this.contentLength === 0) {
          // 对于块级 当执行删除块内容为空时候 将被br填充 此时光标停留在段首
          range.setStart(startContainer, 0)
        } else if (startContainer.len === 0) {
          const { path: prevSibling } = this.caretLeave(startContainer, range, 'left')
          if (!prevSibling) return
          if (prevSibling.blockComponent !== startContainer.blockComponent) {
            range.setStart(startContainer, 0)
          } else {
            startContainer.delete()
          }
        } else {
          this._updatePoints(endContainer, endOffset, -1)
        }
      } else {
        const { path: prevSibling } = this.caretLeave(startContainer, range, 'left')
        if (!prevSibling) return
        if (!this.contentLength) {
          const parent = this.$path.parent.component
          this.$path.delete()
          parent.update()
        }
        mergeBlock(startContainer, prevSibling)
      }
    } else if (startContainer === endContainer) {
      startContainer.contentDelete(endOffset, endOffset - startOffset)
    } else {
      startContainer.contentDelete(startContainer.len, startContainer.len - startOffset)
      endContainer.contentDelete(endOffset, endOffset)
      commonPath.deleteBetween(startContainer, endContainer)
      mergeBlock(endContainer, startContainer)
    }
    range.collapse(true)
    this.update(commonPath, range)
  }

  onKeydownB (range, event) {
    this.setFormat(range, event, f => {
      f.bold = !f.bold
    })
  }
  onKeydownD (range, event) {
    this.setFormat(range, event, f => {
      f.del = !f.del
    })
  }
  onKeydownS (range, event) {
    this.setFormat(range, event, f => {
      f.sup = !f.sup
    })
  }
  onKeydownU (range, event) {
    this.setFormat(range, event, f => {
      f.underline = !f.underline
    })
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Component.html">Component</a></li><li><a href="Content.html">Content</a></li><li><a href="Formater.html">Formater</a></li><li><a href="Path.html">Path</a></li><li><a href="Range.html">Range</a></li><li><a href="Selection.html">Selection</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Element">Element</a></li><li><a href="global.html#_genChildren">_genChildren</a></li><li><a href="global.html#addVnodes">addVnodes</a></li><li><a href="global.html#contentDelete">contentDelete</a></li><li><a href="global.html#createKeyToOldIdx">createKeyToOldIdx</a></li><li><a href="global.html#createPath">createPath</a></li><li><a href="global.html#defer">defer</a></li><li><a href="global.html#del">del</a></li><li><a href="global.html#enter">enter</a></li><li><a href="global.html#findIdxInOld">findIdxInOld</a></li><li><a href="global.html#flush">flush</a></li><li><a href="global.html#horizontalMove">horizontalMove</a></li><li><a href="global.html#initDispatcher">initDispatcher</a></li><li><a href="global.html#input">input</a></li><li><a href="global.html#inputText">inputText</a></li><li><a href="global.html#invokeDestroyHook">invokeDestroyHook</a></li><li><a href="global.html#isSameLine">isSameLine</a></li><li><a href="global.html#loop">loop</a></li><li><a href="global.html#patchVnode">patchVnode</a></li><li><a href="global.html#positionCompare">positionCompare</a></li><li><a href="global.html#queryCommonPath">queryCommonPath</a></li><li><a href="global.html#queryPath">queryPath</a></li><li><a href="global.html#queryPathByElm">queryPathByElm</a></li><li><a href="global.html#queryPathByPosition">queryPathByPosition</a></li><li><a href="global.html#queryPathByVn">queryPathByVn</a></li><li><a href="global.html#queryRootPath">queryRootPath</a></li><li><a href="global.html#removeVnodes">removeVnodes</a></li><li><a href="global.html#renderRoot">renderRoot</a></li><li><a href="global.html#sameVnode">sameVnode</a></li><li><a href="global.html#transformOps">transformOps</a></li><li><a href="global.html#updateChildren">updateChildren</a></li><li><a href="global.html#verticalMove">verticalMove</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Mar 19 2023 16:46:35 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
